' Code Generated by Sidekick is for learning and experimentation purposes only.
Sub ConsolidateExcelFiles_RemoveDuplicateCaseIDs()
    Dim folderPath As String
    Dim fileName As String
    Dim wbSource As Workbook
    Dim wsSource As Worksheet
    Dim wbDest As Workbook
    Dim wsDest As Worksheet
    Dim lastRowDest As Long
    Dim i As Long
    Dim caseID As String
    Dim description As String
    Dim timeTaken As Variant
    Dim dict As Object
    Set dict = CreateObject("Scripting.Dictionary")
    
    ' Prompt user to select folder
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "Select Folder with Excel Files"
        If .Show = -1 Then
            folderPath = .SelectedItems(1) & "\"
        Else
            Exit Sub
        End If
    End With
    
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    
    ' Create new workbook for consolidation
    Set wbDest = Workbooks.Add
    Set wsDest = wbDest.Sheets(1)
    wsDest.Name = "Consolidated"
    
    ' Write headers
    wsDest.Range("A1:C1").Value = Array("Case ID", "Description", "Time taken")
    lastRowDest = 2
    
    ' Loop through all .xlsx files in the folder
    fileName = Dir(folderPath & "*.xlsx")
    Do While fileName <> ""
        ' Skip the consolidator workbook itself
        If fileName <> wbDest.Name Then
            Set wbSource = Workbooks.Open(folderPath & fileName, ReadOnly:=True)
            Set wsSource = wbSource.Sheets(1) ' Always Sheet1
            
            caseID = wsSource.Range("B1").Value
            
            ' Only add if Case ID is not already in dictionary
            If Not dict.Exists(caseID) Then
                For i = 4 To 27 ' F4:F27
                    timeTaken = wsSource.Cells(i, 6).Value ' Column F
                    If IsNumeric(timeTaken) And timeTaken > 0 Then
                        description = wsSource.Cells(i, 1).Value ' Column A
                        wsDest.Cells(lastRowDest, 1).Value = caseID
                        wsDest.Cells(lastRowDest, 2).Value = description
                        wsDest.Cells(lastRowDest, 3).Value = timeTaken
                        lastRowDest = lastRowDest + 1
                    End If
                Next i
                dict.Add caseID, True ' Mark this Case ID as processed
            End If
            
            wbSource.Close SaveChanges:=False
        End If
        fileName = Dir
    Loop
    
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    
    ' Save the consolidated workbook in the same folder
    wbDest.SaveAs folderPath & "Consolidated.xlsx"
    wbDest.Close SaveChanges:=False
    
    MsgBox "Consolidation complete! File saved as 'Consolidated.xlsx' in the selected folder.", vbInformation
End Sub
